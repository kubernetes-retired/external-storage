apiVersion: v1
kind: ServiceAccount
metadata:
  name: efs-provisioner
---
kind: Pod
apiVersion: v1
metadata:
  name: efs-provisioner
spec:
  serviceAccount: efs-provisioner
  containers:
    - name: efs-provisioner
      image: quay.io/external_storage/efs-provisioner:latest
      env:
        - name: PROVISIONER_NAME
          value: "example.com/aws-efs"
        - name: FILE_SYSTEM_ID
          valueFrom:
            configMapKeyRef:
              name: efs-provisioner
              key: file.system.id
        - name: AWS_REGION
          valueFrom:
            configMapKeyRef:
              name: efs-provisioner
              key: aws.region
        - name: DNS_NAME
          valueFrom:
            configMapKeyRef:
              name: efs-provisioner
              key: dns.name
              optional: true
        - name: SKIP_PVC_NAMED_PATH
          valueFrom:
            configMapKeyRef:
              name: efs-provisioner
              key: skip.pvc.named.path
              optional: true
        - name: KEEP_PV_PATH
          valueFrom:
            configMapKeyRef:
              name: efs-provisioner
              key: keep.pv.path
              optional: true
      volumeMounts:
        - name: pv-volume
          mountPath: /persistentvolumes
  volumes:
    - name: pv-volume
      nfs:
        server: fs-47a2c22e.efs.us-west-2.amazonaws.com
        path: /persistentvolumes
